const telemetryData = [
  {
    t: 1,
    truck_id: 1,
    timestamp: "2026-01-21T08:00:00Z",
    latitude: 41.8781,
    longitude: -87.6298,
    speed: 0,
  },
  {
    t: 2,
    truck_id: 1,
    timestamp: "2026-01-21T08:05:00Z",
    latitude: 41.881,
    longitude: -87.62,
    speed: 35,
  },
  {
    t: 3,
    truck_id: 1,
    timestamp: "2026-01-21T08:10:00Z",
    latitude: 41.885,
    longitude: -87.61,
    speed: 52,
  },
  {
    t: 4,
    truck_id: 1,
    timestamp: "2026-01-21T08:15:00Z",
    latitude: 41.889,
    longitude: -87.6,
    speed: 55,
  },
  {
    t: 5,
    truck_id: 1,
    timestamp: "2026-01-21T08:20:00Z",
    latitude: 41.895,
    longitude: -87.59,
    speed: 58,
  },
  {
    t: 6,
    truck_id: 1,
    timestamp: "2026-01-21T08:25:00Z",
    latitude: 41.9,
    longitude: -87.58,
    speed: 60,
  },
  {
    t: 7,
    truck_id: 1,
    timestamp: "2026-01-21T08:30:00Z",
    latitude: 41.905,
    longitude: -87.57,
    speed: 62,
  },
  {
    t: 8,
    truck_id: 1,
    timestamp: "2026-01-21T08:35:00Z",
    latitude: 41.91,
    longitude: -87.56,
    speed: 63,
  },
  {
    t: 9,
    truck_id: 1,
    timestamp: "2026-01-21T08:40:00Z",
    latitude: 41.915,
    longitude: -87.55,
    speed: 61,
  },
  {
    t: 10,
    truck_id: 1,
    timestamp: "2026-01-21T08:45:00Z",
    latitude: 41.92,
    longitude: -87.54,
    speed: 59,
  },
  {
    t: 11,
    truck_id: 1,
    timestamp: "2026-01-21T08:50:00Z",
    latitude: 41.925,
    longitude: -87.53,
    speed: 60,
  },
  {
    t: 12,
    truck_id: 1,
    timestamp: "2026-01-21T08:55:00Z",
    latitude: 41.93,
    longitude: -87.52,
    speed: 62,
  },
  {
    t: 13,
    truck_id: 1,
    timestamp: "2026-01-21T09:00:00Z",
    latitude: 41.935,
    longitude: -87.51,
    speed: 60,
  },
  {
    t: 14,
    truck_id: 1,
    timestamp: "2026-01-21T09:05:00Z",
    latitude: 41.94,
    longitude: -87.5,
    speed: 58,
  },
  {
    t: 15,
    truck_id: 1,
    timestamp: "2026-01-21T09:10:00Z",
    latitude: 41.945,
    longitude: -87.49,
    speed: 55,
  },
  {
    t: 16,
    truck_id: 1,
    timestamp: "2026-01-21T09:15:00Z",
    latitude: 41.95,
    longitude: -87.48,
    speed: 52,
  },
  {
    t: 17,
    truck_id: 1,
    timestamp: "2026-01-21T09:20:00Z",
    latitude: 41.955,
    longitude: -87.47,
    speed: 50,
  },
  {
    t: 18,
    truck_id: 1,
    timestamp: "2026-01-21T09:25:00Z",
    latitude: 41.96,
    longitude: -87.46,
    speed: 48,
  },
  {
    t: 19,
    truck_id: 1,
    timestamp: "2026-01-21T09:30:00Z",
    latitude: 41.965,
    longitude: -87.45,
    speed: 45,
  },
  {
    t: 20,
    truck_id: 1,
    timestamp: "2026-01-21T09:35:00Z",
    latitude: 41.97,
    longitude: -87.44,
    speed: 42,
  },
  {
    t: 21,
    truck_id: 1,
    timestamp: "2026-01-21T09:40:00Z",
    latitude: 41.975,
    longitude: -87.43,
    speed: 40,
  },
  {
    t: 22,
    truck_id: 1,
    timestamp: "2026-01-21T09:45:00Z",
    latitude: 41.98,
    longitude: -87.42,
    speed: 38,
  },
  {
    t: 23,
    truck_id: 1,
    timestamp: "2026-01-21T09:50:00Z",
    latitude: 41.985,
    longitude: -87.41,
    speed: 37,
  },
  {
    t: 24,
    truck_id: 1,
    timestamp: "2026-01-21T09:55:00Z",
    latitude: 41.99,
    longitude: -87.4,
    speed: 35,
  },
  {
    t: 25,
    truck_id: 1,
    timestamp: "2026-01-21T10:00:00Z",
    latitude: 41.995,
    longitude: -87.39,
    speed: 36,
  },
  {
    t: 26,
    truck_id: 1,
    timestamp: "2026-01-21T10:05:00Z",
    latitude: 42,
    longitude: -87.38,
    speed: 38,
  },
  {
    t: 27,
    truck_id: 1,
    timestamp: "2026-01-21T10:10:00Z",
    latitude: 42.005,
    longitude: -87.37,
    speed: 40,
  },
  {
    t: 28,
    truck_id: 1,
    timestamp: "2026-01-21T10:15:00Z",
    latitude: 42.01,
    longitude: -87.36,
    speed: 42,
  },
  {
    t: 29,
    truck_id: 1,
    timestamp: "2026-01-21T10:20:00Z",
    latitude: 42.015,
    longitude: -87.35,
    speed: 45,
  },
  {
    t: 30,
    truck_id: 1,
    timestamp: "2026-01-21T10:25:00Z",
    latitude: 42.02,
    longitude: -87.34,
    speed: 47,
  },
  {
    t: 31,
    truck_id: 1,
    timestamp: "2026-01-21T10:30:00Z",
    latitude: 42.025,
    longitude: -87.33,
    speed: 50,
  },
  {
    t: 32,
    truck_id: 1,
    timestamp: "2026-01-21T10:35:00Z",
    latitude: 42.03,
    longitude: -87.32,
    speed: 52,
  },
  {
    t: 33,
    truck_id: 1,
    timestamp: "2026-01-21T10:40:00Z",
    latitude: 42.035,
    longitude: -87.31,
    speed: 55,
  },
  {
    t: 34,
    truck_id: 1,
    timestamp: "2026-01-21T10:45:00Z",
    latitude: 42.04,
    longitude: -87.3,
    speed: 58,
  },
  {
    t: 35,
    truck_id: 1,
    timestamp: "2026-01-21T10:50:00Z",
    latitude: 42.045,
    longitude: -87.29,
    speed: 60,
  },
  {
    t: 36,
    truck_id: 1,
    timestamp: "2026-01-21T10:55:00Z",
    latitude: 42.05,
    longitude: -87.28,
    speed: 62,
  },
  {
    t: 37,
    truck_id: 1,
    timestamp: "2026-01-21T11:00:00Z",
    latitude: 42.055,
    longitude: -87.27,
    speed: 60,
  },
  {
    t: 38,
    truck_id: 1,
    timestamp: "2026-01-21T11:05:00Z",
    latitude: 42.06,
    longitude: -87.26,
    speed: 58,
  },
  {
    t: 39,
    truck_id: 1,
    timestamp: "2026-01-21T11:10:00Z",
    latitude: 42.065,
    longitude: -87.25,
    speed: 55,
  },
  {
    t: 40,
    truck_id: 1,
    timestamp: "2026-01-21T11:15:00Z",
    latitude: 42.07,
    longitude: -87.24,
    speed: 52,
  },
  {
    t: 41,
    truck_id: 1,
    timestamp: "2026-01-21T11:20:00Z",
    latitude: 42.075,
    longitude: -87.23,
    speed: 50,
  },
  {
    t: 42,
    truck_id: 1,
    timestamp: "2026-01-21T11:25:00Z",
    latitude: 42.08,
    longitude: -87.22,
    speed: 48,
  },
  {
    t: 43,
    truck_id: 1,
    timestamp: "2026-01-21T11:30:00Z",
    latitude: 42.085,
    longitude: -87.21,
    speed: 45,
  },
  {
    t: 44,
    truck_id: 1,
    timestamp: "2026-01-21T11:35:00Z",
    latitude: 42.09,
    longitude: -87.2,
    speed: 42,
  },
  {
    t: 45,
    truck_id: 1,
    timestamp: "2026-01-21T11:40:00Z",
    latitude: 42.095,
    longitude: -87.19,
    speed: 40,
  },
  {
    t: 46,
    truck_id: 1,
    timestamp: "2026-01-21T11:45:00Z",
    latitude: 42.1,
    longitude: -87.18,
    speed: 38,
  },
  {
    t: 47,
    truck_id: 1,
    timestamp: "2026-01-21T11:50:00Z",
    latitude: 42.105,
    longitude: -87.17,
    speed: 35,
  },
];

const elements = {
  truckId: document.getElementById("truckId"),
  totalRecords: document.getElementById("totalRecords"),
  tRange: document.getElementById("tRange"),
  tNumber: document.getElementById("tNumber"),
  tMin: document.getElementById("tMin"),
  tMax: document.getElementById("tMax"),
  tCurrent: document.getElementById("tCurrent"),
  timestamp: document.getElementById("timestamp"),
  speed: document.getElementById("speed"),
  speedStatus: document.getElementById("speedStatus"),
  latitude: document.getElementById("latitude"),
  longitude: document.getElementById("longitude"),
  locationSummary: document.getElementById("locationSummary"),
  tableBody: document.getElementById("tableBody"),
};

const tValues = telemetryData.map((point) => point.t);
const minT = Math.min(...tValues);
const maxT = Math.max(...tValues);

function clampT(value) {
  if (Number.isNaN(value)) {
    return minT;
  }
  return Math.min(maxT, Math.max(minT, value));
}

function getSpeedStatus(speed) {
  if (speed === 0) {
    return { label: "Stopped", className: "stopped" };
  }
  if (speed < 10) {
    return { label: "Crawling", className: "caution" };
  }
  if (speed < 55) {
    return { label: "Moving", className: "moving" };
  }
  return { label: "High speed", className: "fast" };
}

function formatCoordinate(value) {
  return value.toFixed(4);
}

function renderSelectedPoint(tValue) {
  const record = telemetryData.find((point) => point.t === tValue);

  if (!record) {
    elements.tableBody.innerHTML =
      '<tr><td colspan="6">No data for this t value.</td></tr>';
    return;
  }

  elements.truckId.textContent = record.truck_id;
  elements.timestamp.textContent = record.timestamp;
  elements.speed.textContent = `${record.speed} mph`;
  elements.latitude.textContent = formatCoordinate(record.latitude);
  elements.longitude.textContent = formatCoordinate(record.longitude);
  elements.locationSummary.textContent = `${formatCoordinate(
    record.latitude
  )}, ${formatCoordinate(record.longitude)}`;

  const status = getSpeedStatus(record.speed);
  elements.speedStatus.textContent = status.label;
  elements.speedStatus.className = `status ${status.className}`;

  elements.tableBody.innerHTML = `
    <tr>
      <td>${record.t}</td>
      <td>${record.truck_id}</td>
      <td>${record.timestamp}</td>
      <td>${record.latitude}</td>
      <td>${record.longitude}</td>
      <td>${record.speed}</td>
    </tr>
  `;
}

function updateSelection(value) {
  const tValue = clampT(parseInt(value, 10));
  elements.tRange.value = tValue;
  elements.tNumber.value = tValue;
  elements.tCurrent.textContent = tValue;
  renderSelectedPoint(tValue);
}

function initializeDashboard() {
  elements.totalRecords.textContent = telemetryData.length;
  elements.tMin.textContent = minT;
  elements.tMax.textContent = maxT;
  elements.tRange.min = minT;
  elements.tRange.max = maxT;
  elements.tNumber.min = minT;
  elements.tNumber.max = maxT;

  elements.tRange.addEventListener("input", (event) => {
    updateSelection(event.target.value);
  });

  elements.tNumber.addEventListener("input", (event) => {
    updateSelection(event.target.value);
  });

  updateSelection(minT);
}

initializeDashboard();
